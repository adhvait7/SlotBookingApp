<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Student Dashboard</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Libre Baskerville", serif;
        background-color: #0a1a0f;
        color: #cddfcb;
      }

      .dashboard-container {
        display: flex;
        min-height: 100vh;
      }

      /* ---------- SIDEBAR ---------- */
      .sidebar {
        width: 260px;
        background-color: #122f23;
        padding: 30px 20px;
        border-right: 1px solid #2e4d3d;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin-bottom: 20px;
        border: 2px solid #3fb88a;
      }

      .sidebar h3 {
        margin: 10px 0;
        font-size: 18px;
        color: #a7e8c2;
      }

      .sidebar p {
        font-size: 13px;
        margin: 4px 0;
        text-align: center;
        color: #b4d5b2;
      }

      .sidebar a {
        font-size: 14px;
        color: #8ae6ce;
        margin: 10px 0;
        text-decoration: none;
        font-weight: bold;
      }

      .sidebar a:hover {
        text-decoration: underline;
      }

      .logout-form {
        margin-top: auto;
        width: 100%;
      }

      .logout-form button {
        width: 100%;
        padding: 10px;
        background-color: #e53935;
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
      }

      .logout-form button:hover {
        background-color: #c62828;
      }

      /* ---------- MAIN ---------- */
      .main-content {
        flex: 1;
        padding: 40px;
      }

      h1 {
        color: #a7e8c2;
        margin-bottom: 20px;
        text-align: center;
        font-size: 24px;
      }

      /* ---------- FLASH ---------- */
      .flash-container {
        max-width: 800px;
        margin: 0 auto 20px;
      }

      .flash {
        padding: 10px 14px;
        border-radius: 6px;
        margin-bottom: 10px;
        font-size: 14px;
      }

      .flash-success {
        background-color: #e6f4ea;
        color: #1e4620;
      }

      .flash-error {
        background-color: #fdecea;
        color: #611a15;
      }

      .flash-info {
        background-color: #e8f0fe;
        color: #1a3d7c;
      }

      /* ---------- TABLE ---------- */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-size: 14px;
        background-color: #122f23;
      }

      th,
      td {
        padding: 12px;
        text-align: center;
        border: 1px solid #3a5d4f;
      }

      th {
        background-color: #2f5944;
        color: #ffffff;
      }

      tbody tr:hover {
        background-color: #1a3b2f;
      }

      /* ---------- BOOKING ---------- */
      .booking-form {
        margin-top: 30px;
        display: flex;
        flex-wrap: wrap;
        gap: 14px;
        align-items: center;
        justify-content: center;
      }

      .booking-form label {
        color: #8ae6ce;
        font-size: 14px;
      }

      .booking-form select {
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid #3a5d4f;
        background-color: #1a3b2f;
        color: #fff;
      }

      .booking-form button {
        padding: 10px 18px;
        background-color: #3fb88a;
        border: none;
        border-radius: 6px;
        color: white;
        font-weight: 600;
        cursor: pointer;
      }

      .booking-form button:hover {
        background-color: #2f9470;
      }
    </style>
  </head>

  <body>
    <div class="dashboard-container">
      <!-- SIDEBAR -->
      <div class="sidebar">
        <img
          class="avatar"
          src="https://img.freepik.com/free-vector/blue-circle-with-white-user_78370-4707.jpg"
          alt="Profile Picture"
        />

        <h3>{{ username }}</h3>
        <p>Role: {{ role }}</p>

        <form action="{{ url_for('logout') }}" method="GET" class="logout-form">
          <button type="submit">Logout</button>
        </form>
      </div>

      <!-- MAIN -->
      <div class="main-content">
        <h1>Student Dashboard</h1>

        <!-- FLASH MESSAGES -->
        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %}
        <div class="flash-container">
          {% for category, message in messages %}
          <div class="flash flash-{{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
        {% endif %} {% endwith %}

        <!-- TIMETABLE -->
        <table>
          <thead>
            <tr>
              <th>Day / Time</th>
              {% for slot in slots_str %}
              <th>{{ slot }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for day in table_data %}
            <tr>
              <td>{{ day }}</td>
              {% for slot in slots_str %}
              <td>{{ table_data[day].get(slot) or "Unassigned" }}</td>
              {% endfor %}
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <!-- BOOK SLOT -->
        <form
          action="{{ url_for('book_slot') }}"
          method="POST"
          class="booking-form"
        >
          <label for="day">Day</label>
          <select name="day" id="day" required>
            <option value="">Select Day</option>
            {% for day in table_data %}
            <option value="{{ day }}">{{ day }}</option>
            {% endfor %}
          </select>

          <label for="timeDropDown">Time</label>
          <select name="timeDropDown" id="timeDropDown" required>
            <option value="">Select Time</option>
          </select>

          <button type="submit">Book Class</button>
        </form>
      </div>
    </div>

    <!-- SCRIPT -->
    <script>
      document.getElementById("day").addEventListener("change", function () {
        const selectedDay = this.value;
        const timeDropdown = document.getElementById("timeDropDown");

        timeDropdown.innerHTML = "<option value=''>Select Time</option>";

        if (!selectedDay) return;

        const url = "{{ url_for('get_timeslots', day='__DAY__') }}".replace(
          "__DAY__",
          selectedDay
        );

        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            data.forEach((time) => {
              const option = document.createElement("option");
              option.value = time;
              option.textContent = time;
              timeDropdown.appendChild(option);
            });
          })
          .catch((err) => console.error("Error fetching slots:", err));
      });
    </script>
  </body>
</html>
